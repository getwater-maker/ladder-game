<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사다리 게임</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="css/style.css?v=6">
    <link rel="stylesheet" href="css/goals.css?v=6">
    <link rel="stylesheet" href="css/scheduler.css?v=4">
</head>

<body>
    <div class="app-container">
        <!-- Start Screen (Mode Selection) -->
        <div id="start-screen" class="screen active">
            <h1 class="bounce">🎲 사다리 게임 🎲</h1>

            <!-- User Profile Section (Removed) -->
            <!-- Login not required anymore -->

            <div class="mode-selection">
                <div class="mode-card" onclick="openScheduler()">
                    <div class="mode-characters">📅</div>
                    <h3>해야 할 일</h3>
                    <p>매일매일 체크하고 용돈 벌자!</p>
                </div>
                <div class="mode-card" onclick="startFamilyGame()">
                    <div class="mode-characters">🐻 🐱 🐰</div>
                    <h3>가족 게임</h3>
                    <p>한봄 · 한별 · 한빛</p>
                </div>
                <div class="mode-card" onclick="showSetupScreen()">
                    <div class="mode-characters">👥</div>
                    <h3>사다리 게임</h3>
                    <p>직접 설정하기</p>
                </div>
                <div class="mode-card" onclick="startChessGame()">
                    <div class="mode-characters">♟️</div>
                    <h3>체스 게임</h3>
                    <p>AI 또는 친구와 대결!</p>
                </div>
                <div class="mode-card" onclick="showOmokScreen()">
                    <div class="mode-characters">⚪⚫</div>
                    <h3>오목 게임</h3>
                    <p>AI 또는 가족과 대결!</p>
                </div>
            </div>
        </div>

        <!-- Omok Setup Screen -->
        <div id="omok-screen" class="screen hidden">
            <div class="game-mode-select">
                <h2>⚫ 오목 게임 ⚪</h2>
                <!-- Mode Selection Step -->
                <div id="omok-mode-step">
                    <p class="game-mode-subtitle">상대를 선택하세요!</p>
                    <div class="game-mode-cards">
                        <div class="mode-card" onclick="showOmokLevelSelect()">
                            <div class="mode-characters">🤖</div>
                            <h3>컴퓨터와 대결</h3>
                            <p>난이도를 선택!</p>
                        </div>
                        <div class="mode-card" onclick="showOmokPvpStep()">
                            <div class="mode-characters">👫</div>
                            <h3>친구와 대결</h3>
                            <p>온라인으로 대결!</p>
                        </div>
                    </div>
                </div>
                <!-- PvP Room Code + Color Selection Step -->
                <div id="omok-pvp-step" class="hidden">
                    <h3>온라인 대결 설정</h3>
                    <div class="room-code-input" style="margin-bottom:15px">
                        <input type="text" id="omok-room-code" placeholder="방 코드 (예: 1234)" maxlength="10">
                    </div>
                    <p>색상을 선택하세요</p>
                    <div class="color-select-row">
                        <button class="color-btn selected" id="omok-color-b" onclick="selectOmokColor('b')">⚫ 흑돌 (선공)</button>
                        <button class="color-btn" id="omok-color-w" onclick="selectOmokColor('w')">⚪ 백돌</button>
                    </div>
                    <button class="btn-primary" onclick="joinOmokRoom()" style="margin-top:15px">입장</button>
                </div>
                <button class="btn-small" onclick="backFromOmokStep()" style="margin-top:20px">← 돌아가기</button>
            </div>
        </div>

        <!-- Omok Level Selection Screen -->
        <div id="omok-level-screen" class="screen hidden">
            <h2>🤖 난이도 선택</h2>
            <p>자신에게 맞는 레벨을 선택하세요!</p>
            <div class="level-grid">
                <button class="level-btn l-easy" onclick="initOmokGame('ai', 1); showOmokBoard();">1</button>
                <button class="level-btn l-easy" onclick="initOmokGame('ai', 2); showOmokBoard();">2</button>
                <button class="level-btn l-easy" onclick="initOmokGame('ai', 3); showOmokBoard();">3</button>
                <button class="level-btn l-easy" onclick="initOmokGame('ai', 4); showOmokBoard();">4</button>

                <button class="level-btn l-mid" onclick="initOmokGame('ai', 5); showOmokBoard();">5</button>
                <button class="level-btn l-mid" onclick="initOmokGame('ai', 6); showOmokBoard();">6</button>
                <button class="level-btn l-mid" onclick="initOmokGame('ai', 7); showOmokBoard();">7</button>
                <button class="level-btn l-mid" onclick="initOmokGame('ai', 8); showOmokBoard();">8</button>

                <button class="level-btn l-hard" onclick="initOmokGame('ai', 9); showOmokBoard();">9</button>
                <button class="level-btn l-hard" onclick="initOmokGame('ai', 10); showOmokBoard();">10</button>
                <button class="level-btn l-hard" onclick="initOmokGame('ai', 11); showOmokBoard();">11</button>
                <button class="level-btn l-hard" onclick="initOmokGame('ai', 12); showOmokBoard();">12 (🔥)</button>
            </div>
            <button class="btn-small" onclick="backToOmokMode()" style="margin-top:20px">← 뒤로가기</button>
        </div>

        <!-- Omok Game Board Area -->
        <div id="omok-game-area" class="screen hidden">
            <div class="game-header">
                <h2 id="omok-status">⚫ 흑돌 차례</h2>
                <div class="controls">
                    <button class="btn-small" onclick="restartOmok()">다시 하기</button>
                    <button class="btn-small" onclick="backToStartFromOmok()">나가기</button>
                </div>
            </div>
            <div class="omok-board-container">
                <div id="omok-board" class="omok-board"></div>
            </div>
        </div>


        <!-- Setup Screen (General Mode) -->
        <div id="setup-screen" class="screen hidden">
            <h2>🎲 일반 사다리 게임</h2>
            <div class="setup-container">
                <div class="count-control">
                    <span class="count-label">참가자 수</span>
                    <button class="count-btn" onclick="changeCount(-1)">−</button>
                    <span class="count-display" id="player-count">4</span>
                    <button class="count-btn" onclick="changeCount(1)">+</button>
                </div>
                <div class="input-header">
                    <span></span>
                    <span>이름</span>
                    <span>아이템</span>
                </div>
                <div class="input-grid" id="input-grid"></div>
                <div class="setup-buttons">
                    <button class="btn-small" onclick="backToStart()">← 돌아가기</button>
                    <button class="btn-primary" onclick="startGeneralGame()">게임 시작!</button>
                </div>
            </div>
        </div>

        <!-- Game Screen (Shared) -->
        <div id="game-screen" class="screen hidden">
            <div class="header">
                <div class="header-left">
                    <h2 id="round-title">라운드 1 / 3</h2>
                    <p id="round-subtitle">📺 한봄의 TV 시청</p>
                </div>
                <div class="header-right">
                    <div class="current-player" id="current-player-info">
                        <span id="current-player-avatar" class="current-avatar">🐻</span>
                        <span id="current-player-name">한봄</span>
                    </div>
                    <button class="btn-small" id="btn-edit-game" onclick="openFamilyEdit()" style="display:none">설정</button>
                    <button class="btn-small" id="btn-prev-round" onclick="prevFamilyRound()" style="display:none">◀ 이전</button>
                    <button class="btn-small" id="btn-next-round" onclick="skipToNextRound()" style="display:none">다음 ▶</button>
                    <button class="btn-small" onclick="backToStart()">처음으로</button>
                </div>
            </div>

            <p class="instruction" id="instruction">👆 위에서 번호를 하나 선택하세요!</p>

            <div class="ladder-container">
                <canvas id="ladderCanvas"></canvas>
                <div id="start-nodes" class="nodes-row top"></div>
                <div id="end-nodes" class="nodes-row bottom"></div>
            </div>
        </div>

        <!-- Chess Screen -->
        <div id="chess-screen" class="screen hidden">
            <!-- Chess Mode Selection -->
            <div id="chess-mode-select" class="chess-mode-select">
                <h2>♟️ 체스 게임</h2>
                <!-- Mode Selection -->
                <div id="chess-mode-step" class="chess-step">
                    <p class="chess-mode-subtitle">상대를 선택하세요!</p>
                    <div class="chess-mode-cards">
                        <div class="mode-card" onclick="showAiLevelSelect()">
                            <div class="mode-characters">🤖</div>
                            <h3>컴퓨터와 대결</h3>
                            <p>난이도를 선택!</p>
                        </div>
                        <div class="mode-card" onclick="showChessPvpRoom()">
                            <div class="mode-characters">👫</div>
                            <h3>친구와 대결</h3>
                            <p>온라인으로 대결!</p>
                        </div>
                    </div>
                </div>
                <!-- AI Level Selection -->
                <div id="chess-level-step" class="chess-step hidden">
                    <p class="chess-mode-subtitle">컴퓨터 난이도를 선택하세요!</p>
                    <div class="chess-level-cards">
                        <div class="level-card level-1" onclick="initChessGame('ai', 1)">
                            <div class="level-icon">🐣</div>
                            <h3>레벨 1</h3>
                            <p>처음 배우는 중</p>
                        </div>
                        <div class="level-card level-2" onclick="initChessGame('ai', 2)">
                            <div class="level-icon">🐥</div>
                            <h3>레벨 2</h3>
                            <p>조금 할 줄 알아</p>
                        </div>
                        <div class="level-card level-3" onclick="initChessGame('ai', 3)">
                            <div class="level-icon">🦅</div>
                            <h3>레벨 3</h3>
                            <p>자신 있어!</p>
                        </div>
                    </div>
                </div>
                <!-- PvP Room Code + Color Selection -->
                <div id="chess-pvp-step" class="chess-step hidden">
                    <h3>온라인 대결 설정</h3>
                    <div class="room-code-input" style="margin-bottom:15px">
                        <input type="text" id="chess-room-code" placeholder="방 코드 (예: 1234)" maxlength="10">
                    </div>
                    <p>색상을 선택하세요</p>
                    <div class="color-select-row">
                        <button class="color-btn selected" id="chess-color-w" onclick="selectChessColor('w')">⬜ 흰색</button>
                        <button class="color-btn" id="chess-color-b" onclick="selectChessColor('b')">⬛ 검은색</button>
                    </div>
                    <button class="btn-primary" onclick="joinChessRoom()" style="margin-top:15px">입장</button>
                </div>
                <button class="btn-small" onclick="backFromChessStep()" style="margin-top:20px">← 돌아가기</button>
            </div>
            <!-- Chess Game Area (hidden until mode selected) -->
            <div id="chess-game-area" class="hidden">
                <div class="chess-header">
                    <h2>♟️ 체스 게임</h2>
                    <button class="btn-small" onclick="backToStartFromChess()">처음으로</button>
                </div>
                <div class="chess-status" id="chess-status">당신의 차례입니다 (흰색)</div>
                <div class="chess-captured" id="chess-captured-black"></div>
                <div class="chess-board-container">
                    <div class="chess-board" id="chess-board"></div>
                </div>
                <div class="chess-captured" id="chess-captured-white"></div>
                <div class="chess-controls">
                    <button class="btn-primary chess-btn" onclick="chessNewGame()">새 게임</button>
                    <button class="btn-small" onclick="chessUndo()">↩ 되돌리기</button>
                </div>
            </div>
        </div>

        <!-- Result Modal -->
        <div id="result-modal" class="modal hidden">
            <div class="modal-content">
                <h2 id="modal-player-name">결과!</h2>
                <div id="modal-result-icon" class="result-icon">🎁</div>
                <h1 id="modal-result-text">결과 내용</h1>
                <div id="modal-details" class="details-box hidden"></div>
                <div id="modal-btn-area" class="modal-btn-area"></div>
            </div>
        </div>

        <!-- Scheduler Modal (Replaces Goals Modal) -->
        <div id="scheduler-modal" class="modal hidden">
            <div class="scheduler-container">
                <div class="scheduler-header">
                    <div class="scheduler-header-top">
                        <div class="month-nav">
                            <button class="nav-btn" onclick="changeSchedulerDate(-1)">◀</button>
                            <span id="scheduler-month">2024.2</span>
                            <button class="nav-btn" onclick="changeSchedulerDate(1)">▶</button>
                            <button class="btn-today" onclick="goToday()">오늘</button>
                        </div>
                        <div class="scheduler-header-buttons">
                            <button class="btn-icon" onclick="openSettings()">⚙️</button>
                            <button class="btn-icon" onclick="closeScheduler()">✖</button>
                        </div>
                    </div>

                    <div class="child-tabs scheduler-tabs">
                        <button class="tab-btn active" onclick="switchSchedulerTab('한봄')">🐻 한봄</button>
                        <button class="tab-btn" onclick="switchSchedulerTab('한별')">🐱 한별</button>
                        <button class="tab-btn" onclick="switchSchedulerTab('한빛')">🐰 한빛</button>
                    </div>

                    <div class="scheduler-summary-row">
                        <div class="wallet-display">
                            <span>💰 </span><span id="scheduler-wallet">0원</span>
                        </div>
                        <div class="settlement-display">
                            <span class="settlement-item" onclick="showSettlement('week')">주정산: <b id="week-settlement">0원</b></span>
                            <span class="settlement-item" onclick="showSettlement('month')">월정산: <b id="month-settlement">0원</b></span>
                        </div>
                    </div>
                    <!-- buttons moved to header-top -->
                </div>

                <div id="scheduler-grid" class="scheduler-grid">
                    <!-- Grid Injected Here -->
                </div>
            </div>
        </div>

        <!-- Family Edit Modal -->
        <div id="family-edit-modal" class="modal hidden">
            <div class="family-edit-modal">
                <h2>가족 게임 설정</h2>
                <div id="family-round-list"></div>
                <div class="add-round-form">
                    <input type="text" id="new-round-player" placeholder="이름 (예: 아빠)">
                    <input type="text" id="new-round-cat" placeholder="카테고리 (예: 설거지)">
                    <input type="text" id="new-round-opts" placeholder="옵션 (쉼표구분: 1회,2회)">
                    <button class="btn-small" onclick="addNewFamilyRound()">추가</button>
                </div>
                <button class="btn-primary" onclick="closeFamilyEdit()" style="margin-top:20px; width:100%">닫기</button>
            </div>
        </div>


        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content settings-content">
                <h2>⚙️ 할 일 및 용돈 설정</h2>

                <div class="child-tabs">
                    <button class="tab-btn active" onclick="switchSettingsTab('한봄')">🐻 한봄</button>
                    <button class="tab-btn" onclick="switchSettingsTab('한별')">🐱 한별</button>
                    <button class="tab-btn" onclick="switchSettingsTab('한빛')">🐰 한빛</button>
                </div>

                <div id="settings-task-list" class="settings-list">
                    <!-- Settings items injected here -->
                </div>

                <div class="add-task-form">
                    <input type="text" id="new-task-name" placeholder="새로운 할 일" style="flex:2">
                    <input type="number" id="new-task-reward" placeholder="보상(원)" value="100" style="flex:1">
                    <input type="number" id="new-task-qty" placeholder="횟수" value="1" style="flex:0.5; min-width:50px">
                    <button class="btn-small" onclick="addNewTask()">추가</button>
                </div>

                <div class="modal-btn-area">
                    <button class="btn-primary" onclick="closeSettings()">저장 및 닫기</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { app, auth, db } from './js/firebase-config.js';
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDb = db;
    </script>
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/chess.js"></script>
    <script type="module" src="js/scheduler.js"></script>
</body>

</html>